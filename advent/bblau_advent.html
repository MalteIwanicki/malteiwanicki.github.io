<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Advent Calendar</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <link
        href="https://fonts.googleapis.com/css2?family=Merriweather:wght@300;400;700&family=Inter:wght@300;400;600&display=swap"
        rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #0f172a;
            color: #f1f5f9;
            overflow-x: hidden;
        }

        h1,
        h2,
        h3,
        .font-serif {
            font-family: 'Merriweather', serif;
        }

        /* 3D Door Flip Animation */
        .perspective-1000 {
            perspective: 1000px;
        }

        .preserve-3d {
            transform-style: preserve-3d;
        }

        .backface-hidden {
            backface-visibility: hidden;
        }

        .rotate-y-180 {
            transform: rotateY(180deg);
        }

        /* Snow Animation */
        .snowflake {
            position: fixed;
            top: -10px;
            z-index: 0;
            color: white;
            opacity: 0.2;
            animation-name: fall;
            animation-timing-function: linear;
            animation-iteration-count: infinite;
            pointer-events: none;
        }

        @keyframes fall {
            0% {
                transform: translateY(-10vh) translateX(-10px);
            }

            100% {
                transform: translateY(100vh) translateX(10px);
            }
        }

        /* Shake Animation */
        @keyframes shake {

            0%,
            100% {
                transform: translateX(0);
            }

            25% {
                transform: translateX(-5px);
            }

            75% {
                transform: translateX(5px);
            }
        }

        .shaking {
            animation: shake 0.4s cubic-bezier(.36, .07, .19, .97) both;
        }

        /* Modal Transitions */
        .modal-backdrop {
            opacity: 0;
            visibility: hidden;
            transition: opacity 0.3s ease, visibility 0.3s ease;
        }

        .modal-backdrop.open {
            opacity: 1;
            visibility: visible;
        }

        .modal-content {
            transform: scale(0.95);
            transition: transform 0.3s ease;
        }

        .modal-backdrop.open .modal-content {
            transform: scale(1);
        }

    </style>
</head>

<body class="min-h-screen pb-20">

    <!-- Snow Container -->
    <div id="snow-container"></div>

    <div class="max-w-6xl mx-auto p-4 relative z-10">
        <!-- Header -->
        <header class="text-center mb-12 mt-8">
            <h1
                class="text-4xl md:text-6xl font-bold text-transparent bg-clip-text bg-gradient-to-r from-red-500 via-red-200 to-red-500 mb-4 drop-shadow-lg">
                Advent Calendar
            </h1>
            <p class="text-slate-300 text-lg font-light tracking-wider">
                A new surprise, every single day.
            </p>
        </header>

        <!-- Controls -->
        <div class="absolute top-4 right-4 flex gap-2 z-20">
            <!-- <button id="test-mode-btn"
                class="px-3 py-1 rounded-full text-xs font-mono transition-colors bg-slate-800 text-slate-500 border border-slate-700 hover:bg-slate-700">
                Test Mode: OFF
            </button> -->
            <button id="reset-btn"
                class="px-3 py-1 rounded-full text-xs font-mono bg-slate-800 text-slate-500 border border-slate-700 hover:text-red-400 hover:border-red-900 transition-colors">
                Reset
            </button>
        </div>

        <!-- Grid -->
        <div id="calendar-grid" class="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-6 gap-4 md:gap-6">
            <!-- Doors injected by JS -->
        </div>
    </div>

    <!-- Modal -->
    <div id="modal"
        class="modal-backdrop fixed inset-0 z-50 flex items-center justify-center p-4 bg-black/80 backdrop-blur-sm">
        <div
            class="modal-content bg-white rounded-2xl w-full max-w-lg overflow-hidden shadow-2xl flex flex-col max-h-[90vh]">
            <!-- Modal Header -->
            <div class="bg-red-600 p-4 flex justify-between items-center text-white shrink-0">
                <h3 class="text-xl font-serif font-bold flex items-center gap-2">
                    <span id="modal-day-badge"
                        class="bg-white/20 w-8 h-8 rounded-full flex items-center justify-center text-sm font-sans">1</span>
                    <span id="modal-title">December 1</span>
                </h3>
                <button id="modal-close" class="hover:bg-white/20 rounded-full p-1 transition-colors">
                    <i data-lucide="x"></i>
                </button>
            </div>

            <!-- Modal Body -->
            <div class="p-6 flex flex-col items-center text-center gap-4 overflow-y-auto">

                <!-- Preview Container -->
                <div
                    class="relative w-full group cursor-pointer bg-slate-100 rounded-lg border border-slate-200 shadow-inner overflow-hidden aspect-[1/1.4]">
                    <!-- Image -->
                    <img id="modal-img" src="" alt="Preview"
                        class="absolute inset-0 w-full h-full object-cover object-top transition-transform duration-500 group-hover:scale-105"
                        onerror="this.style.display='none'">

                    <!-- Fallback Icon -->
                    <div class="absolute inset-0 flex items-center justify-center text-slate-300 -z-10">
                        <i data-lucide="file-text" size="48"></i>
                    </div>

                    <!-- Hover Overlay -->
                    <a id="modal-link-overlay" href="#" target="_blank"
                        class="absolute inset-0 bg-black/0 group-hover:bg-black/20 transition-colors flex items-center justify-center opacity-0 group-hover:opacity-100 z-10">
                        <span
                            class="bg-white text-slate-900 px-4 py-2 rounded-full font-bold shadow-lg transform translate-y-4 group-hover:translate-y-0 transition-transform text-sm">
                            Open PDF
                        </span>
                    </a>
                </div>

                <div class="mt-2 w-full">
                    <a id="modal-btn" href="#" target="_blank"
                        class="flex items-center justify-center gap-2 w-full px-6 py-3 bg-red-600 text-white rounded-xl font-bold hover:bg-red-700 transition-colors shadow-lg shadow-red-200 group">
                        <i data-lucide="download" class="group-hover:-translate-y-1 transition-transform"></i>
                        Download / Open PDF
                    </a>
                    <p class="text-xs text-gray-400 mt-2">(Opens in new tab)</p>
                </div>
            </div>
        </div>
    </div>

    <script>
        // --- CONFIGURATION ---
        const TOTAL_DAYS = 24;
        const STORAGE_KEY = 'adventOpenedDoors';

        // State
        let testMode = false;
        let openedDoors = JSON.parse(localStorage.getItem(STORAGE_KEY) || '[]');

        // --- DOM ELEMENTS ---
        const grid = document.getElementById('calendar-grid');
        const modal = document.getElementById('modal');
        const snowContainer = document.getElementById('snow-container');
        const testBtn = document.getElementById('test-mode-btn');
        const resetBtn = document.getElementById('reset-btn');

        // --- INITIALIZATION ---

        // Generate Data
        const calendarData = Array.from({length: TOTAL_DAYS}, (_, i) => {
            const num = i + 1;
            const str = num.toString().padStart(2, '0');
            return {
                id: num,
                title: `December ${num}`,
                pdfUrl: `./pdfs/bblau-${str}.pdf`,
                previewUrl: `./images/bblau-${str}.png`
            };
        });

        // Decoration Icons
        const icons = ['star', 'gift', 'heart', 'music', 'coffee', 'sparkles'];

        // Render Grid
        function renderGrid() {
            grid.innerHTML = '';
            calendarData.forEach(day => {
                const isOpen = openedDoors.includes(day.id);
                const isLocked = checkLocked(day.id);
                const iconName = icons[day.id % icons.length];

                const card = document.createElement('div');
                card.className = 'relative aspect-square cursor-pointer group perspective-1000';
                card.onclick = () => handleDoorClick(day, card);

                card.innerHTML = `
                    <div class="door-inner w-full h-full rounded-xl shadow-sm transition-all duration-700 preserve-3d ${isOpen ? 'rotate-y-180' : 'hover:shadow-lg hover:-translate-y-1'} ${isLocked && !isOpen ? 'cursor-not-allowed opacity-90' : ''}">
                        <!-- Front -->
                        <div class="absolute inset-0 backface-hidden bg-gradient-to-br from-red-600 to-red-800 rounded-xl border-2 border-yellow-500/50 flex flex-col items-center justify-center text-white shadow-inner z-10 overflow-hidden">
                            ${isLocked
                        ? `<i data-lucide="lock" class="mb-2 text-red-200 opacity-50"></i>`
                        : `<div class="mb-2 text-amber-200 opacity-80 animate-pulse"><i data-lucide="${iconName}" width="16"></i></div>`
                    }
                            <span class="text-3xl font-serif font-bold text-shadow-sm relative z-10">${day.id}</span>
                            <div class="absolute inset-0 bg-[url('https://www.transparenttextures.com/patterns/stardust.png')] opacity-20"></div>
                        </div>

                        <!-- Back -->
                        <div class="absolute inset-0 backface-hidden rotate-y-180 bg-white rounded-xl border-2 border-dashed border-red-200 flex items-center justify-center overflow-hidden">
                            <div class="text-center p-2">
                                <span class="text-sm font-bold text-red-500 uppercase tracking-wider mb-1 block">Open</span>
                                <div class="text-red-400 flex justify-center">
                                    <i data-lucide="file-text" width="28" height="28"></i>
                                </div>
                            </div>
                        </div>
                    </div>
                `;
                grid.appendChild(card);
            });
            lucide.createIcons();
        }

        // --- LOGIC ---

        function checkLocked(dayId) {
            if (testMode) return false;
            const now = new Date();
            // Month is 0-indexed (11 is December)
            return now.getMonth() !== 11 || now.getDate() < dayId;
        }

        function handleDoorClick(day, cardElement) {
            const isLocked = checkLocked(day.id);
            const alreadyOpen = openedDoors.includes(day.id);

            if (isLocked && !alreadyOpen) {
                // Shake animation
                cardElement.classList.add('shaking');
                setTimeout(() => cardElement.classList.remove('shaking'), 500);
                return;
            }

            // Open Door logic
            if (!alreadyOpen) {
                openedDoors.push(day.id);
                localStorage.setItem(STORAGE_KEY, JSON.stringify(openedDoors));
                renderGrid(); // Re-render to show open state
            }

            // Show Modal
            openModal(day);
        }

        function openModal(day) {
            document.getElementById('modal-day-badge').innerText = day.id;
            document.getElementById('modal-title').innerText = day.title;

            const img = document.getElementById('modal-img');
            img.style.display = 'block'; // Reset display
            img.src = day.previewUrl;

            document.getElementById('modal-btn').href = day.pdfUrl;
            document.getElementById('modal-link-overlay').href = day.pdfUrl;

            modal.classList.add('open');
        }

        function closeModal() {
            modal.classList.remove('open');
        }

        function toggleTestMode() {
            testMode = !testMode;
            testBtn.innerText = testMode ? "Test Mode: ON" : "Test Mode: OFF";
            testBtn.className = testMode
                ? "px-3 py-1 rounded-full text-xs font-mono transition-colors bg-green-600 text-white border border-green-500"
                : "px-3 py-1 rounded-full text-xs font-mono transition-colors bg-slate-800 text-slate-500 border border-slate-700 hover:bg-slate-700";
            renderGrid();
        }

        function resetData() {
            if (confirm("Reset all opened doors?")) {
                openedDoors = [];
                localStorage.setItem(STORAGE_KEY, JSON.stringify([]));
                renderGrid();
            }
        }

        // --- SNOW EFFECT ---
        function createSnow() {
            for (let i = 0; i < 30; i++) {
                const flake = document.createElement('div');
                flake.className = 'snowflake';
                flake.innerHTML = 'â„';
                flake.style.left = Math.random() * 100 + '%';
                flake.style.animationDuration = (Math.random() * 10 + 10) + 's';
                flake.style.animationDelay = (Math.random() * 5) + 's';
                flake.style.fontSize = (Math.random() * 20 + 10) + 'px';
                snowContainer.appendChild(flake);
            }
        }

        // --- LISTENERS ---
        document.getElementById('modal-close').onclick = closeModal;
        document.getElementById('modal').onclick = (e) => {
            if (e.target === modal) closeModal();
        };
        testBtn.onclick = toggleTestMode;
        resetBtn.onclick = resetData;

        // Start
        createSnow();
        renderGrid();

    </script>
</body>

</html>
