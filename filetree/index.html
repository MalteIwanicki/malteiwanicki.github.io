<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>File Tree Generator</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            padding: 20px;
            max-width: 1200px;
            margin: 0 auto;
            background: #f5f5f5;
        }

        .header {
            background: white;
            padding: 30px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
            margin-bottom: 20px;
        }

        h1 {
            color: #333;
            margin-bottom: 10px;
        }

        .subtitle {
            color: #666;
            margin-bottom: 20px;
        }

        .privacy-notice {
            display: flex;
            gap: 15px;
            align-items: flex-start;
            background: linear-gradient(135deg, #e8f5e9 0%, #c8e6c9 100%);
            border: 2px solid #4caf50;
            border-radius: 8px;
            padding: 20px;
            margin: 20px 0;
        }

        .privacy-icon {
            font-size: 28px;
            line-height: 1;
            color: #2e7d32;
        }

        .privacy-text {
            flex: 1;
        }

        .privacy-text strong {
            color: #2e7d32;
            font-size: 18px;
            display: block;
            margin-bottom: 8px;
        }

        .privacy-text p {
            color: #1b5e20;
            margin: 0;
            line-height: 1.5;
        }

        .controls {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            align-items: center;
        }

        button {
            padding: 12px 24px;
            font-size: 16px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.2s;
            font-weight: 500;
        }

        .primary-btn {
            background: #0066cc;
            color: white;
        }

        .primary-btn:hover {
            background: #0052a3;
        }

        .primary-btn:disabled {
            background: #ccc;
            cursor: not-allowed;
        }

        .secondary-btn {
            background: #f0f0f0;
            color: #333;
        }

        .secondary-btn:hover {
            background: #e0e0e0;
        }

        .copy-btn {
            background: #0066cc;
            color: white;
            font-weight: 600;
        }

        .copy-btn:hover {
            background: #0052a3;
        }

        .copy-btn:disabled {
            background: #ccc;
            cursor: not-allowed;
        }

        .tree-container {
            background: white;
            padding: 30px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
            display: none;
        }

        .tree-container.active {
            display: block;
        }

        .tree-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 2px solid #e0e0e0;
        }

        .tree-title {
            font-size: 18px;
            color: #333;
            font-weight: 600;
        }

        ul {
            list-style-type: none;
            padding-left: 0;
            margin: 0;
        }

        ul.root {
            font-family: 'SFMono-Regular', Consolas, 'Liberation Mono', Menlo, monospace;
            font-size: 14px;
        }

        li {
            margin: 0;
            cursor: default;
        }

        .tree-row-content {
            display: grid;
            grid-template-columns: 50px 1fr;
            gap: 10px;
            padding: 0px 10px;
            border-radius: 4px;
            align-items: center;
            transition: background 0.15s ease;
            width: 100%;
        }

        .tree-row-content:hover {
            background: #f5f9ff;
        }

        .row-controls {
            display: flex;
            gap: 6px;
            align-items: center;
            flex-wrap: wrap;
            width: 50px;
            min-width: 50px;
        }

        .row-label {
            white-space: pre;
            font-family: 'SFMono-Regular', Consolas, 'Liberation Mono', Menlo, monospace;
            color: #333;
        }

        .folder-row .row-label {
            cursor: pointer;
        }

        .ignore-btn,
        .toggle-btn {
            cursor: pointer;
            background: #fff;
            border: 1px solid #d0d7de;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 4px;
            transition: all 0.2s;
            color: #344054;
        }

        .ignore-btn {
            width: 18px;
            height: 18px;
            max-height: 18px;
            min-height: 18px;
            padding: 0;
            font-size: 11px;
            border-radius: 3px;
        }

        .toggle-btn {
            width: 17px;
            height: 17px;
            padding: 0;
            font-size: 16px;
            font-weight: 700;
            line-height: 1;
        }

        .ignore-btn:hover,
        .toggle-btn:hover {
            background: #eef2ff;
            border-color: #5c6bc0;
            color: #283593;
        }

        .ignore-btn.active {
            color: #d32f2f;
            border-color: #d32f2f;
            background: #ffebee;
        }

        .ignored {
            opacity: 0.4;
        }

        .ignored .row-label {
            color: #888;
            text-decoration: line-through;
        }

        .nested {
            display: none;
            padding-left: 0;
            margin-left: 0;
        }

        .nested.active {
            display: block;
        }

        .status {
            margin-top: 10px;
            padding: 10px;
            border-radius: 4px;
            display: none;
        }

        .status.info {
            background: #e3f2fd;
            color: #1976d2;
            display: block;
        }

        .status.error {
            background: #ffebee;
            color: #c62828;
            display: block;
        }

        .status.success {
            background: #e8f5e9;
            color: #2e7d32;
            display: block;
        }

        .copy-notification {
            position: fixed;
            top: 20px;
            right: 20px;
            background: #2e7d32;
            color: white;
            padding: 20px 28px;
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
            display: none;
            animation: slideIn 0.3s ease;
            max-width: 600px;
            max-height: 400px;
            overflow-y: auto;
            z-index: 1000;
        }

        .copy-notification.show {
            display: block;
        }

        .copy-notification-title {
            font-weight: 600;
            margin-bottom: 10px;
            font-size: 16px;
        }

        .copy-notification-content {
            font-family: monospace;
            font-size: 12px;
            white-space: pre;
            background: rgba(0, 0, 0, 0.2);
            padding: 10px;
            border-radius: 4px;
            margin-top: 8px;
        }

        @keyframes slideIn {
            from {
                transform: translateX(400px);
                opacity: 0;
            }

            to {
                transform: translateX(0);
                opacity: 1;
            }
        }

        .info-section {
            margin-top: 15px;
            background: #fafafa;
            border: 1px solid #e0e0e0;
            border-radius: 6px;
            overflow: hidden;
        }

        .info-body {
            padding: 20px;
            color: #333;
            line-height: 1.6;
        }

        .info-body h3 {
            color: #555;
            margin-top: 20px;
            margin-bottom: 10px;
            font-size: 16px;
        }

        .info-body h3:first-child {
            margin-top: 0;
        }

        .info-body ul {
            padding-left: 20px;
            list-style-type: disc;
        }

        .info-body li {
            margin: 6px 0;
        }

        .info-body code {
            background: #f5f5f5;
            padding: 2px 6px;
            border-radius: 3px;
            font-family: monospace;
            font-size: 14px;
            color: #c7254e;
        }

        .info-body strong {
            color: #333;
        }



        .stats {
            margin-top: 15px;
            padding: 10px;
            background: #f0f7ff;
            border-radius: 4px;
            font-size: 14px;
            color: #555;
        }

        @media (max-width: 768px) {
            body {
                padding: 10px;
            }

            .header {
                padding: 20px;
            }

            .tree-container {
                padding: 20px;
            }
        }

    </style>
</head>

<body>
    <div class="header">
        <h1><i class="fas fa-folder"></i> File Tree Generator</h1>
        <p class="subtitle">Select a folder to generate an interactive file tree structure</p>

        <div class="privacy-notice">
            <div class="privacy-icon"><i class="fas fa-lock"></i></div>
            <div class="privacy-text">
                <strong>100% Private & Secure</strong>
                <p>Your files never leave your computer. All processing happens in your browser. No data is uploaded,
                    tracked, or accessible to anyone.</p>
            </div>
        </div>
        <div class="controls">
            <button id="selectFolder" class="primary-btn"><i class="fas fa-folder-open"></i> Select Folder</button>
            <button id="expandAll" class="secondary-btn" disabled><i class="fas fa-plus"></i> Expand All</button>
            <button id="collapseAll" class="secondary-btn" disabled><i class="fas fa-minus"></i> Collapse All</button>
            <button id="copyTree" class="copy-btn" disabled><i class="fas fa-copy"></i> Copy Tree</button>
            <button id="infoToggleBtn" class="secondary-btn"><i class="fas fa-info-circle"></i> Info <span
                    id="infoArrow"><i class="fas fa-chevron-down"></i></span></button>
        </div>

        <div class="info-section" id="infoSection" style="display: none;">
            <div class="info-body">
                <h3><i class="fas fa-book"></i> What is this tool?</h3>
                <p>The File Tree Generator creates a visual representation of your folder structure. It's perfect
                    for
                    documentation, sharing project layouts, or getting a quick overview of any directory.</p>

                <h3><i class="fas fa-rocket"></i> How to use</h3>
                <ul>
                    <li><strong>Select Folder:</strong> Click to choose a folder from your computer. A browser
                        dialog
                        will appear.</li>
                    <li><strong>Expand All:</strong> Opens all folders in the tree to show the complete structure.
                    </li>
                    <li><strong>Collapse All:</strong> Closes all folders for a compact view.</li>
                    <li><strong>Copy Tree:</strong> Copies the folder structure as ASCII text to your clipboard.
                    </li>
                </ul>

                <h3><i class="fas fa-bullseye"></i> Features</h3>
                <ul>
                    <li><strong>Interactive tree:</strong> Click on folder names to expand or collapse them.</li>
                    <li><strong>Inline ignore buttons:</strong> Click the × button next to any file or folder to exclude
                        it from the copied output. Ignored items appear faded with strikethrough.
                    </li>
                    <li><strong>Statistics:</strong> See the total count of folders and files in your selection.
                    </li>
                    <li><strong>ASCII output:</strong> Generated tree uses standard box-drawing characters (├──,
                        └──, │)
                        for universal compatibility.</li>
                </ul>

                <h3><i class="fas fa-lock"></i> Privacy & Security</h3>
                <p>All processing happens locally in your browser. No files are uploaded to any server. Your data
                    never
                    leaves your computer. The app uses the modern File System Access API to read folder structures
                    without requiring file uploads.</p>

                <h3><i class="fas fa-lightbulb"></i> Tips</h3>
                <ul>
                    <li>Click the × button to ignore files or folders you don't want in your output. They appear faded
                        with strikethrough.</li>
                    <li>Only expanded folders and non-ignored items are included when you copy the tree.</li>
                    <li>The copied tree text works great in documentation, README files, or chat messages.</li>
                    <li>Items are sorted alphabetically with folders appearing before files.</li>
                    <li>This tool requires a modern browser (Chrome, Edge, or other Chromium-based browsers).</li>
                </ul>

                <h3><i class="fas fa-clipboard"></i> Example Output</h3>
                <p>When you copy the tree, it generates text like this:</p>
                <code style="display: block; padding: 10px; margin-top: 8px; white-space: pre;">my-project
├── src
│   ├── components
│   │   └── Button.js
│   └── index.js
├── package.json
└── README.md</code>
            </div>
        </div>

        <div id="status" class="status"></div>
    </div>



    <div id="treeContainer" class="tree-container">
        <div class="tree-header">
            <div class="tree-title" id="folderName">Folder Structure</div>
            <div class="stats" id="stats"></div>
        </div>
        <ul id="fileTree" class="root"></ul>
    </div>

    <div id="copyNotification" class="copy-notification">
        <div class="copy-notification-title"><i class="fas fa-check"></i> File tree copied to clipboard!</div>
        <div class="copy-notification-content" id="copyNotificationContent"></div>
    </div>

    <script>
        let folderHandle = null;
        let fileTreeData = null;
        let stats = {folders: 0, files: 0};

        const selectFolderBtn = document.getElementById('selectFolder');
        const expandAllBtn = document.getElementById('expandAll');
        const collapseAllBtn = document.getElementById('collapseAll');
        const copyTreeBtn = document.getElementById('copyTree');
        const statusDiv = document.getElementById('status');
        const treeContainer = document.getElementById('treeContainer');
        const fileTreeElement = document.getElementById('fileTree');
        const folderNameElement = document.getElementById('folderName');
        const statsElement = document.getElementById('stats');
        const copyNotification = document.getElementById('copyNotification');
        const copyNotificationContent = document.getElementById('copyNotificationContent');
        const infoToggleBtn = document.getElementById('infoToggleBtn');
        const infoSection = document.getElementById('infoSection');
        const infoArrow = document.getElementById('infoArrow');

        // Store ignored items by path
        let ignoredItems = new Set();

        // Info section toggle with arrow
        infoToggleBtn.addEventListener('click', () => {
            if (infoSection.style.display === 'none') {
                infoSection.style.display = 'block';
                infoArrow.innerHTML = '<i class="fas fa-chevron-up"></i>';
            } else {
                infoSection.style.display = 'none';
                infoArrow.innerHTML = '<i class="fas fa-chevron-down"></i>';
            }
        });

        // Check if File System Access API is supported
        if (!('showDirectoryPicker' in window)) {
            showStatus('error', 'Your browser does not support the File System Access API. Please use Chrome, Edge, or another Chromium-based browser.');
            selectFolderBtn.disabled = true;
        }

        selectFolderBtn.addEventListener('click', selectFolder);
        expandAllBtn.addEventListener('click', expandAll);
        collapseAllBtn.addEventListener('click', collapseAll);
        copyTreeBtn.addEventListener('click', copyToClipboard);

        async function selectFolder() {
            try {
                folderHandle = await window.showDirectoryPicker();
                showStatus('info', 'Reading folder structure...');

                stats = {folders: 0, files: 0};
                fileTreeData = await readDirectory(folderHandle);
                ignoredItems = new Set();

                folderNameElement.textContent = `${folderHandle.name}/`;
                statsElement.textContent = `${stats.folders} folders, ${stats.files} files`;

                renderTree(fileTreeData, fileTreeElement);
                treeContainer.classList.add('active');

                expandAllBtn.disabled = false;
                collapseAllBtn.disabled = false;
                copyTreeBtn.disabled = false;

                showStatus('success', `Successfully loaded ${folderHandle.name}`);
                setTimeout(() => hideStatus(), 3000);
            } catch (error) {
                if (error.name !== 'AbortError') {
                    showStatus('error', `Error: ${error.message}`);
                } else {
                    hideStatus();
                }
            }
        }

        async function readDirectory(dirHandle, path = '') {
            const entries = [];

            for await (const entry of dirHandle.values()) {
                if (entry.kind === 'directory') {
                    stats.folders++;
                    const children = await readDirectory(entry, path + entry.name + '/');
                    entries.push({
                        name: entry.name,
                        type: 'directory',
                        children: children,
                        path: path + entry.name
                    });
                } else {
                    stats.files++;
                    entries.push({
                        name: entry.name,
                        type: 'file',
                        path: path + entry.name
                    });
                }
            }

            // Sort: directories first, then alphabetically
            return entries.sort((a, b) => {
                if (a.type !== b.type) {
                    return a.type === 'directory' ? -1 : 1;
                }
                return a.name.localeCompare(b.name);
            });
        }

        function renderTree(data, parentElement, prefix = '') {
            parentElement.innerHTML = '';

            data.forEach((item, index) => {
                const li = document.createElement('li');
                const isDirectory = item.type === 'directory';
                const isIgnored = ignoredItems.has(item.path);
                const isLastItem = index === data.length - 1;

                const row = document.createElement('div');
                row.className = `tree-row-content ${isDirectory ? 'folder-row' : 'file-row'}` + (isIgnored ? ' ignored' : '');
                row.dataset.path = item.path;

                const controls = document.createElement('div');
                controls.className = 'row-controls';

                const ignoreBtn = document.createElement('button');
                ignoreBtn.className = 'ignore-btn' + (isIgnored ? ' active' : '');
                ignoreBtn.textContent = '×';
                ignoreBtn.title = isIgnored ? 'Include in tree' : 'Ignore in tree';
                controls.appendChild(ignoreBtn);

                const label = document.createElement('div');
                label.className = 'row-label';
                const connector = prefix + (isLastItem ? '└── ' : '├── ');
                const labelText = isDirectory ? `${item.name}/` : item.name;
                label.textContent = connector + labelText;

                row.appendChild(controls);
                row.appendChild(label);
                li.appendChild(row);

                let childrenContainer = null;

                if (isDirectory) {
                    const toggleBtn = document.createElement('button');
                    toggleBtn.className = 'toggle-btn';
                    toggleBtn.textContent = '+';
                    toggleBtn.title = 'Expand folder';
                    controls.appendChild(toggleBtn);

                    childrenContainer = document.createElement('ul');
                    childrenContainer.className = 'nested';
                    li.appendChild(childrenContainer);

                    if (item.children && item.children.length > 0) {
                        renderTree(item.children, childrenContainer, prefix + (isLastItem ? '    ' : '│   '));
                    }

                    const toggleState = (open) => setFolderState(row, childrenContainer, open);

                    toggleBtn.addEventListener('click', (e) => {
                        e.stopPropagation();
                        toggleState(!row.classList.contains('open'));
                    });

                    label.addEventListener('click', () => {
                        toggleState(!row.classList.contains('open'));
                    });

                    toggleState(false);
                }

                ignoreBtn.addEventListener('click', (e) => {
                    e.stopPropagation();
                    toggleIgnore(item.path, row, childrenContainer, ignoreBtn);
                });

                if (isDirectory && isIgnored && childrenContainer) {
                    childrenContainer.classList.add('ignored');
                }

                parentElement.appendChild(li);
            });
        }

        function toggleIgnore(path, rowElement, nestedElement, buttonElement) {
            if (ignoredItems.has(path)) {
                ignoredItems.delete(path);
                rowElement.classList.remove('ignored');
                if (nestedElement) {
                    nestedElement.classList.remove('ignored');
                }
                if (buttonElement) {
                    buttonElement.classList.remove('active');
                    buttonElement.title = 'Ignore in tree';
                }
            } else {
                ignoredItems.add(path);
                rowElement.classList.add('ignored');
                if (nestedElement) {
                    nestedElement.classList.add('ignored');
                }
                if (buttonElement) {
                    buttonElement.classList.add('active');
                    buttonElement.title = 'Include in tree';
                }
            }
        }

        function expandAll() {
            document.querySelectorAll('.folder-row').forEach(row => {
                const nested = row.parentElement.querySelector('.nested');
                if (nested) {
                    setFolderState(row, nested, true);
                }
            });
        }

        function collapseAll() {
            document.querySelectorAll('.folder-row').forEach(row => {
                const nested = row.parentElement.querySelector('.nested');
                if (nested) {
                    setFolderState(row, nested, false);
                }
            });
        }

        function generateAsciiTree(data, prefix = '', isLast = true, onlyExpanded = false) {
            let result = '';

            const filteredData = data.filter(item => !ignoredItems.has(item.path));

            filteredData.forEach((item, index) => {
                const isLastItem = index === filteredData.length - 1;
                const connector = isLastItem ? '└── ' : '├── ';
                const newPrefix = prefix + (isLastItem ? '    ' : '│   ');

                const label = item.type === 'directory' ? `${item.name}/` : item.name;
                result += prefix + connector + label + '\n';

                if (item.type === 'directory' && item.children && item.children.length > 0) {
                    if (onlyExpanded) {
                        const folderRow = getFolderRowByPath(item.path);
                        if (folderRow && folderRow.classList.contains('open')) {
                            result += generateAsciiTree(item.children, newPrefix, isLastItem, onlyExpanded);
                        }
                    } else {
                        result += generateAsciiTree(item.children, newPrefix, isLastItem, onlyExpanded);
                    }
                }
            });

            return result;
        }

        async function copyToClipboard() {
            try {
                if (!folderHandle) {
                    showStatus('error', 'Please select a folder first');
                    return;
                }

                const asciiTree = `${folderHandle.name}/\n` + generateAsciiTree(fileTreeData, '', true, true);
                await navigator.clipboard.writeText(asciiTree);

                copyNotificationContent.textContent = asciiTree;
                copyNotification.classList.add('show');

                setTimeout(() => {
                    copyNotification.classList.remove('show');
                }, 3000);
            } catch (error) {
                showStatus('error', 'Failed to copy to clipboard');
            }
        }

        function setFolderState(rowElement, nestedElement, open) {
            if (!rowElement || !nestedElement) return;

            if (open) {
                nestedElement.classList.add('active');
                rowElement.classList.add('open');
                const toggleBtn = rowElement.querySelector('.toggle-btn');
                if (toggleBtn) {
                    toggleBtn.textContent = '-';
                    toggleBtn.title = 'Collapse folder';
                }
            } else {
                nestedElement.classList.remove('active');
                rowElement.classList.remove('open');
                const toggleBtn = rowElement.querySelector('.toggle-btn');
                if (toggleBtn) {
                    toggleBtn.textContent = '+';
                    toggleBtn.title = 'Expand folder';
                }
            }
        }

        function getFolderRowByPath(path) {
            const selectorValue = (window.CSS && CSS.escape) ? CSS.escape(path) : path.replace(/"/g, '\\"');
            return document.querySelector(`.folder-row[data-path="${selectorValue}"]`);
        }

        function showStatus(type, message) {
            statusDiv.className = `status ${type}`;
            statusDiv.textContent = message;
        }

        function hideStatus() {
            statusDiv.className = 'status';
        }
    </script>
</body>

</html>
