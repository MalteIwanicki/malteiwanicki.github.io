<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>File Tree Generator</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            padding: 20px;
            max-width: 1200px;
            margin: 0 auto;
            background: #f5f5f5;
        }

        .header {
            background: white;
            padding: 30px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
            margin-bottom: 20px;
        }

        h1 {
            color: #333;
            margin-bottom: 10px;
        }

        .subtitle {
            color: #666;
            margin-bottom: 20px;
        }

        .privacy-notice {
            display: flex;
            gap: 15px;
            align-items: flex-start;
            background: linear-gradient(135deg, #e8f5e9 0%, #c8e6c9 100%);
            border: 2px solid #4caf50;
            border-radius: 8px;
            padding: 20px;
            margin: 20px 0;
        }

        .privacy-icon {
            font-size: 28px;
            line-height: 1;
            color: #2e7d32;
        }

        .privacy-text {
            flex: 1;
        }

        .privacy-text strong {
            color: #2e7d32;
            font-size: 18px;
            display: block;
            margin-bottom: 8px;
        }

        .privacy-text p {
            color: #1b5e20;
            margin: 0;
            line-height: 1.5;
        }

        .controls {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            align-items: center;
        }

        button {
            padding: 12px 24px;
            font-size: 16px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.2s;
            font-weight: 500;
        }

        .primary-btn {
            background: #0066cc;
            color: white;
        }

        .primary-btn:hover {
            background: #0052a3;
        }

        .primary-btn:disabled {
            background: #ccc;
            cursor: not-allowed;
        }

        .secondary-btn {
            background: #f0f0f0;
            color: #333;
        }

        .secondary-btn:hover {
            background: #e0e0e0;
        }

        .copy-btn {
            background: #0066cc;
            color: white;
            font-weight: 600;
        }

        .copy-btn:hover {
            background: #0052a3;
        }

        .copy-btn:disabled {
            background: #ccc;
            cursor: not-allowed;
        }

        .tree-container {
            background: white;
            padding: 30px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
            display: none;
        }

        .tree-container.active {
            display: block;
        }

        .tree-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 2px solid #e0e0e0;
        }

        .tree-title {
            font-size: 18px;
            color: #333;
            font-weight: 600;
        }

        ul {
            list-style-type: none;
            padding-left: 0;
            margin-left: 40px;
            border-left: 1px solid #e0e0e0;
            padding-left: 20px;
        }

        ul.root {
            margin-left: 0;
            border-left: none;
            padding-left: 0;
        }

        li {
            margin: 2px 0;
            cursor: default;
            position: relative;
        }

        .folder,
        .file {
            display: grid;
            grid-template-columns: 24px 1px 1fr;
            align-items: center;
            gap: 6px;
            padding: 2px 0;
        }

        .folder {
            user-select: none;
        }

        .folder:hover,
        .file:hover {
            background: #f8f8f8;
        }

        .ignore-column {
            display: flex;
            justify-content: center;
            align-items: center;
        }

        .column-divider {
            width: 1px;
            height: 20px;
            background: #e0e0e0;
        }

        .folder-content {
            display: flex;
            align-items: center;
            cursor: pointer;
        }

        .folder-icon {
            color: #757575;
            margin-right: 6px;
        }

        .folder.open .folder-icon {
            color: #5c6bc0;
        }

        .file-content {
            display: flex;
            align-items: center;
        }

        .file-content .file-icon {
            margin-right: 6px;
            color: #757575;
        }

        .ignore-btn {
            cursor: pointer;
            background: none;
            border: none;
            padding: 2px 4px;
            font-size: 13px;
            color: #ccc;
            transition: all 0.2s;
            border-radius: 3px;
            width: 20px;
            height: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .ignore-btn:hover {
            background: #ffebee;
            color: #d32f2f;
        }

        .ignore-btn.active {
            color: #d32f2f;
            background: #ffebee;
        }

        .ignored {
            opacity: 0.4;
            text-decoration: line-through;
            color: #999;
        }

        .ignored .folder-icon,
        .ignored .file-icon {
            opacity: 0.5;
        }

        .nested {
            display: none;
            padding-left: 20px;
        }

        .nested.active {
            display: block;
        }

        .status {
            margin-top: 10px;
            padding: 10px;
            border-radius: 4px;
            display: none;
        }

        .status.info {
            background: #e3f2fd;
            color: #1976d2;
            display: block;
        }

        .status.error {
            background: #ffebee;
            color: #c62828;
            display: block;
        }

        .status.success {
            background: #e8f5e9;
            color: #2e7d32;
            display: block;
        }

        .copy-notification {
            position: fixed;
            top: 20px;
            right: 20px;
            background: #2e7d32;
            color: white;
            padding: 20px 28px;
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
            display: none;
            animation: slideIn 0.3s ease;
            max-width: 600px;
            max-height: 400px;
            overflow-y: auto;
            z-index: 1000;
        }

        .copy-notification.show {
            display: block;
        }

        .copy-notification-title {
            font-weight: 600;
            margin-bottom: 10px;
            font-size: 16px;
        }

        .copy-notification-content {
            font-family: monospace;
            font-size: 12px;
            white-space: pre;
            background: rgba(0, 0, 0, 0.2);
            padding: 10px;
            border-radius: 4px;
            margin-top: 8px;
        }

        @keyframes slideIn {
            from {
                transform: translateX(400px);
                opacity: 0;
            }

            to {
                transform: translateX(0);
                opacity: 1;
            }
        }

        .info-section {
            margin-top: 15px;
            background: #fafafa;
            border: 1px solid #e0e0e0;
            border-radius: 6px;
            overflow: hidden;
        }

        .info-body {
            padding: 20px;
            color: #333;
            line-height: 1.6;
        }

        .info-body h3 {
            color: #555;
            margin-top: 20px;
            margin-bottom: 10px;
            font-size: 16px;
        }

        .info-body h3:first-child {
            margin-top: 0;
        }

        .info-body ul {
            padding-left: 20px;
            list-style-type: disc;
        }

        .info-body li {
            margin: 6px 0;
        }

        .info-body code {
            background: #f5f5f5;
            padding: 2px 6px;
            border-radius: 3px;
            font-family: monospace;
            font-size: 14px;
            color: #c7254e;
        }

        .info-body strong {
            color: #333;
        }



        .stats {
            margin-top: 15px;
            padding: 10px;
            background: #f0f7ff;
            border-radius: 4px;
            font-size: 14px;
            color: #555;
        }

        @media (max-width: 768px) {
            body {
                padding: 10px;
            }

            .header {
                padding: 20px;
            }

            .tree-container {
                padding: 20px;
            }
        }

    </style>
</head>

<body>
    <div class="header">
        <h1><i class="fas fa-folder"></i> File Tree Generator</h1>
        <p class="subtitle">Select a folder to generate an interactive file tree structure</p>

        <div class="privacy-notice">
            <div class="privacy-icon"><i class="fas fa-lock"></i></div>
            <div class="privacy-text">
                <strong>100% Private & Secure</strong>
                <p>Your files never leave your computer. All processing happens in your browser. No data is uploaded,
                    tracked, or accessible to anyone.</p>
            </div>
        </div>
        <div class="controls">
            <button id="selectFolder" class="primary-btn"><i class="fas fa-folder-open"></i> Select Folder</button>
            <button id="expandAll" class="secondary-btn" disabled><i class="fas fa-plus"></i> Expand All</button>
            <button id="collapseAll" class="secondary-btn" disabled><i class="fas fa-minus"></i> Collapse All</button>
            <button id="copyTree" class="copy-btn" disabled><i class="fas fa-copy"></i> Copy Tree</button>
            <button id="infoToggleBtn" class="secondary-btn"><i class="fas fa-info-circle"></i> Info <span
                    id="infoArrow"><i class="fas fa-chevron-down"></i></span></button>
        </div>

        <div class="info-section" id="infoSection" style="display: none;">
            <div class="info-body">
                <h3><i class="fas fa-book"></i> What is this tool?</h3>
                <p>The File Tree Generator creates a visual representation of your folder structure. It's perfect
                    for
                    documentation, sharing project layouts, or getting a quick overview of any directory.</p>

                <h3><i class="fas fa-rocket"></i> How to use</h3>
                <ul>
                    <li><strong>Select Folder:</strong> Click to choose a folder from your computer. A browser
                        dialog
                        will appear.</li>
                    <li><strong>Expand All:</strong> Opens all folders in the tree to show the complete structure.
                    </li>
                    <li><strong>Collapse All:</strong> Closes all folders for a compact view.</li>
                    <li><strong>Copy Tree:</strong> Copies the folder structure as ASCII text to your clipboard.
                    </li>
                </ul>

                <h3><i class="fas fa-bullseye"></i> Features</h3>
                <ul>
                    <li><strong>Interactive tree:</strong> Click on folder names to expand or collapse them.</li>
                    <li><strong>Inline ignore buttons:</strong> Click the × button next to any file or folder to exclude
                        it from the copied output. Ignored items appear faded with strikethrough.
                    </li>
                    <li><strong>Statistics:</strong> See the total count of folders and files in your selection.
                    </li>
                    <li><strong>ASCII output:</strong> Generated tree uses standard box-drawing characters (├──,
                        └──, │)
                        for universal compatibility.</li>
                </ul>

                <h3><i class="fas fa-lock"></i> Privacy & Security</h3>
                <p>All processing happens locally in your browser. No files are uploaded to any server. Your data
                    never
                    leaves your computer. The app uses the modern File System Access API to read folder structures
                    without requiring file uploads.</p>

                <h3><i class="fas fa-lightbulb"></i> Tips</h3>
                <ul>
                    <li>Click the × button to ignore files or folders you don't want in your output. They appear faded
                        with strikethrough.</li>
                    <li>Only expanded folders and non-ignored items are included when you copy the tree.</li>
                    <li>The copied tree text works great in documentation, README files, or chat messages.</li>
                    <li>Items are sorted alphabetically with folders appearing before files.</li>
                    <li>This tool requires a modern browser (Chrome, Edge, or other Chromium-based browsers).</li>
                </ul>

                <h3><i class="fas fa-clipboard"></i> Example Output</h3>
                <p>When you copy the tree, it generates text like this:</p>
                <code style="display: block; padding: 10px; margin-top: 8px; white-space: pre;">my-project
├── src
│   ├── components
│   │   └── Button.js
│   └── index.js
├── package.json
└── README.md</code>
            </div>
        </div>

        <div id="status" class="status"></div>
    </div>



    <div id="treeContainer" class="tree-container">
        <div class="tree-header">
            <div class="tree-title" id="folderName">Folder Structure</div>
            <div class="stats" id="stats"></div>
        </div>
        <ul id="fileTree" class="root"></ul>
    </div>

    <div id="copyNotification" class="copy-notification">
        <div class="copy-notification-title"><i class="fas fa-check"></i> File tree copied to clipboard!</div>
        <div class="copy-notification-content" id="copyNotificationContent"></div>
    </div>

    <script>
        let folderHandle = null;
        let fileTreeData = null;
        let stats = {folders: 0, files: 0};

        const selectFolderBtn = document.getElementById('selectFolder');
        const expandAllBtn = document.getElementById('expandAll');
        const collapseAllBtn = document.getElementById('collapseAll');
        const copyTreeBtn = document.getElementById('copyTree');
        const statusDiv = document.getElementById('status');
        const treeContainer = document.getElementById('treeContainer');
        const fileTreeElement = document.getElementById('fileTree');
        const folderNameElement = document.getElementById('folderName');
        const statsElement = document.getElementById('stats');
        const copyNotification = document.getElementById('copyNotification');
        const copyNotificationContent = document.getElementById('copyNotificationContent');
        const infoToggleBtn = document.getElementById('infoToggleBtn');
        const infoSection = document.getElementById('infoSection');
        const infoArrow = document.getElementById('infoArrow');

        // Store ignored items by path
        let ignoredItems = new Set();

        // Info section toggle with arrow
        infoToggleBtn.addEventListener('click', () => {
            if (infoSection.style.display === 'none') {
                infoSection.style.display = 'block';
                infoArrow.innerHTML = '<i class="fas fa-chevron-up"></i>';
            } else {
                infoSection.style.display = 'none';
                infoArrow.innerHTML = '<i class="fas fa-chevron-down"></i>';
            }
        });

        // Check if File System Access API is supported
        if (!('showDirectoryPicker' in window)) {
            showStatus('error', 'Your browser does not support the File System Access API. Please use Chrome, Edge, or another Chromium-based browser.');
            selectFolderBtn.disabled = true;
        }

        selectFolderBtn.addEventListener('click', selectFolder);
        expandAllBtn.addEventListener('click', expandAll);
        collapseAllBtn.addEventListener('click', collapseAll);
        copyTreeBtn.addEventListener('click', copyToClipboard);

        async function selectFolder() {
            try {
                folderHandle = await window.showDirectoryPicker();
                showStatus('info', 'Reading folder structure...');

                stats = {folders: 0, files: 0};
                fileTreeData = await readDirectory(folderHandle);

                folderNameElement.textContent = folderHandle.name;
                statsElement.textContent = `${stats.folders} folders, ${stats.files} files`;

                renderTree(fileTreeData, fileTreeElement);
                treeContainer.classList.add('active');

                expandAllBtn.disabled = false;
                collapseAllBtn.disabled = false;
                copyTreeBtn.disabled = false;

                showStatus('success', `Successfully loaded ${folderHandle.name}`);
                setTimeout(() => hideStatus(), 3000);
            } catch (error) {
                if (error.name !== 'AbortError') {
                    showStatus('error', `Error: ${error.message}`);
                } else {
                    hideStatus();
                }
            }
        }

        async function readDirectory(dirHandle, path = '') {
            const entries = [];

            for await (const entry of dirHandle.values()) {
                if (entry.kind === 'directory') {
                    stats.folders++;
                    const children = await readDirectory(entry, path + entry.name + '/');
                    entries.push({
                        name: entry.name,
                        type: 'directory',
                        children: children,
                        path: path + entry.name
                    });
                } else {
                    stats.files++;
                    entries.push({
                        name: entry.name,
                        type: 'file',
                        path: path + entry.name
                    });
                }
            }

            // Sort: directories first, then alphabetically
            return entries.sort((a, b) => {
                if (a.type !== b.type) {
                    return a.type === 'directory' ? -1 : 1;
                }
                return a.name.localeCompare(b.name);
            });
        }

        function renderTree(data, parentElement) {
            parentElement.innerHTML = '';

            data.forEach(item => {
                const li = document.createElement('li');
                const isIgnored = ignoredItems.has(item.path);

                if (item.type === 'directory') {
                    const folder = document.createElement('div');
                    folder.className = 'folder' + (isIgnored ? ' ignored' : '');

                    const ignoreColumn = document.createElement('div');
                    ignoreColumn.className = 'ignore-column';

                    const ignoreBtn = document.createElement('button');
                    ignoreBtn.className = 'ignore-btn' + (isIgnored ? ' active' : '');
                    ignoreBtn.textContent = '×';
                    ignoreBtn.title = isIgnored ? 'Include in tree' : 'Ignore in tree';

                    ignoreBtn.addEventListener('click', (e) => {
                        e.stopPropagation();
                        toggleIgnore(item.path, folder, li);
                    });

                    ignoreColumn.appendChild(ignoreBtn);

                    const divider = document.createElement('div');
                    divider.className = 'column-divider';

                    const folderContent = document.createElement('div');
                    folderContent.className = 'folder-content';
                    folderContent.innerHTML = `<i class="fas fa-folder folder-icon"></i>${item.name}`;

                    folder.appendChild(ignoreColumn);
                    folder.appendChild(divider);
                    folder.appendChild(folderContent);

                    // Store path as data attribute for lookup
                    folder.dataset.path = item.path;

                    const ul = document.createElement('ul');
                    ul.className = 'nested';

                    folderContent.addEventListener('click', (e) => {
                        e.stopPropagation();
                        ul.classList.toggle('active');
                        folder.classList.toggle('open');
                    });

                    li.appendChild(folder);
                    li.appendChild(ul);

                    if (item.children && item.children.length > 0) {
                        renderTree(item.children, ul);
                    }

                    if (isIgnored) {
                        ul.classList.add('ignored');
                    }
                } else {
                    const fileDiv = document.createElement('div');
                    fileDiv.className = 'file' + (isIgnored ? ' ignored' : '');

                    const ignoreColumn = document.createElement('div');
                    ignoreColumn.className = 'ignore-column';

                    const ignoreBtn = document.createElement('button');
                    ignoreBtn.className = 'ignore-btn' + (isIgnored ? ' active' : '');
                    ignoreBtn.textContent = '×';
                    ignoreBtn.title = isIgnored ? 'Include in tree' : 'Ignore in tree';

                    ignoreBtn.addEventListener('click', (e) => {
                        e.stopPropagation();
                        toggleIgnore(item.path, fileDiv, li);
                    });

                    ignoreColumn.appendChild(ignoreBtn);

                    const divider = document.createElement('div');
                    divider.className = 'column-divider';

                    const fileContent = document.createElement('div');
                    fileContent.className = 'file-content';
                    fileContent.innerHTML = `<i class="fas fa-file file-icon"></i>${item.name}`;

                    fileDiv.appendChild(ignoreColumn);
                    fileDiv.appendChild(divider);
                    fileDiv.appendChild(fileContent);

                    li.appendChild(fileDiv);
                } parentElement.appendChild(li);
            });
        }

        function toggleIgnore(path, ...elements) {
            if (ignoredItems.has(path)) {
                ignoredItems.delete(path);
                elements.forEach(el => el.classList.remove('ignored'));
                // Update ignore button
                elements.forEach(el => {
                    const btn = el.querySelector('.ignore-btn');
                    if (btn) {
                        btn.classList.remove('active');
                        btn.title = 'Ignore in tree';
                    }
                });
            } else {
                ignoredItems.add(path);
                elements.forEach(el => el.classList.add('ignored'));
                // Update ignore button
                elements.forEach(el => {
                    const btn = el.querySelector('.ignore-btn');
                    if (btn) {
                        btn.classList.add('active');
                        btn.title = 'Include in tree';
                    }
                });
            }
        }

        function expandAll() {
            document.querySelectorAll('.nested').forEach(ul => ul.classList.add('active'));
            document.querySelectorAll('.folder').forEach(folder => folder.classList.add('open'));
        }

        function collapseAll() {
            document.querySelectorAll('.nested').forEach(ul => ul.classList.remove('active'));
            document.querySelectorAll('.folder').forEach(folder => folder.classList.remove('open'));
        }

        function generateAsciiTree(data, prefix = '', isLast = true, onlyExpanded = false) {
            let result = '';

            // Filter out ignored items first
            const filteredData = data.filter(item => !ignoredItems.has(item.path));

            filteredData.forEach((item, index) => {
                const isLastItem = index === filteredData.length - 1;
                const connector = isLastItem ? '└── ' : '├── ';
                const newPrefix = prefix + (isLastItem ? '    ' : '│   ');

                result += prefix + connector + item.name + '\n';

                if (item.type === 'directory' && item.children && item.children.length > 0) {
                    // If onlyExpanded is true, check if the folder is currently expanded
                    if (onlyExpanded) {
                        const folderElement = document.querySelector(`[data-path="${item.path}"]`);
                        if (folderElement && folderElement.classList.contains('open')) {
                            result += generateAsciiTree(item.children, newPrefix, isLastItem, onlyExpanded);
                        }
                    } else {
                        result += generateAsciiTree(item.children, newPrefix, isLastItem, onlyExpanded);
                    }
                }
            });

            return result;
        }

        async function copyToClipboard() {
            try {
                const asciiTree = folderHandle.name + '\n' + generateAsciiTree(fileTreeData, '', true, true);
                await navigator.clipboard.writeText(asciiTree);

                // Show the copied content in the notification
                copyNotificationContent.textContent = asciiTree;
                copyNotification.classList.add('show');

                setTimeout(() => {
                    copyNotification.classList.remove('show');
                }, 3000);
            } catch (error) {
                showStatus('error', 'Failed to copy to clipboard');
            }
        }

        function showStatus(type, message) {
            statusDiv.className = `status ${type}`;
            statusDiv.textContent = message;
        }

        function hideStatus() {
            statusDiv.className = 'status';
        }
    </script>
</body>

</html>
